{"version":3,"sources":["../src/reader.js"],"names":["Reader","constructor","dataSubscription","subject","Subject","dataSubject","testClient","Client","getData","url","dataReader","https","get","res","on","data","next","Buffer","from","toString","error","console","log","add_tens_zero","value","parseInt","add_hundreds_zero","force_ones","prepareData","asObservable","subscribe","initPayload","JSON","parse","payload","undefined","last_number","forEach","element","guest_name","substring","padEnd","home_name","init","forceStop","unsubscribe","destroy"],"mappings":"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","sourcesContent":["import Client from './socket';\nimport * as https from 'https';\nimport { Subject, Subscription } from 'rxjs';\nimport { BASE_JSON_URL, SOCKET_HOST, SOCKET_PORT } from './config';\n\n\nexport default class Reader {\n  constructor() {\n    this.dataSubscription = null;\n    this.subject = new Subject();\n    this.dataSubject = new Subject();\n    this.testClient = new Client();\n  }\n\n  getData(url) {\n    let dataReader = this;\n    https.get(url, (res) => {\n  \n      res.on('data', (data) => {\n        // process.stdout.write(d);\n        // console.log(\"Result Data === \", Buffer.from(data).toString());\n        dataReader.subject.next(Buffer.from(data).toString());\n      });\n    }).on('error', (error) => {\n      console.log(error);\n    })\n  }\n  \n  add_tens_zero(value) {\n    if (parseInt(value) > 9)\n      return value.toString();\n    else\n      return ' ' + value;\n  }\n  \n  add_hundreds_zero(value) {\n    if (parseInt(value) >= 100)\n      return value.toString();\n    else if(parseInt(value) >= 10)\n      return ' ' + value;\n    else if (parseInt(value) > 0)\n      return '  ' + value;\n    else\n      return '   ';\n  }\n  \n  force_ones(value) {\n    if (value > 9)\n      return '9';\n    else \n      return value.toString();\n  }\n\n  prepareData() {\n    let dataReader = this; \n    this.dataSubscription = this.subject.asObservable().subscribe((data) => {\n      // console.log(\"Subscribed Data ==== \", JSON.parse(data));\n      let initPayload = JSON.parse(data);\n        /*Payload must be 150 bytes ending with \\n  (151 total)\n              (zero indexed)\n              Position\n              6   balls\n              7   strikes\n              8   Outs\n              9   Innings tens\n              10  Innings ones\n              11  Guest Runs tens\n              12  Guest Runs ones\n              13  Home Runs tens\n              14  Home Runs ones\n              15  Top/Bottom of Inning (T/B)\n              16  Guest Hits tens\n              17  Guest Hits ones\n              18  Home Hits tens\n              19  Home Hits ones\n              20  Guest Errors ones\n              21  Home Errors ones\n              22  Uni for Hitter tens\n              23  Uni for Hitter ones\n              24  Error Flag (H, E or blank)\n              25  Guest Error #\n              26  Top of Inning\n              27  Bottom of Inning\n              28-29 blank\n              30-49  Guest and Home Inning values from 1 - 10\n        */\n       \n        let payload = '';\n        if (initPayload['live_board']['top_of_inning']) {\n          payload = '010000' + \n          initPayload['live_board']['balls'] + \n          initPayload['live_board']['strikes'] +\n          initPayload['live_board']['outs'] + \n          dataReader.add_tens_zero(initPayload['live_board']['inning']) + \n          dataReader.add_tens_zero(initPayload['live_board']['away_score']) + \n          dataReader.add_tens_zero(initPayload['live_board']['home_score']) + \n          'T' + \n          dataReader.add_tens_zero(initPayload['live_board']['away_hits']) + \n          dataReader.add_tens_zero(initPayload['live_board']['home_hits']) + \n          dataReader.force_ones(initPayload['live_board']['away_errors']) + \n          dataReader.force_ones(initPayload['live_board']['home_errors'])\n        } else {\n          payload = '010000' + \n          initPayload['live_board']['balls'] + \n          initPayload['live_board']['strikes'] +\n          initPayload['live_board']['outs'] + \n          dataReader.add_tens_zero(initPayload['live_board']['inning']) + \n          dataReader.add_tens_zero(initPayload['live_board']['away_score']) + \n          dataReader.add_tens_zero(initPayload['live_board']['home_score']) + \n          'B' + \n          dataReader.add_tens_zero(initPayload['live_board']['away_hits']) + \n          dataReader.add_tens_zero(initPayload['live_board']['home_hits']) + \n          dataReader.force_ones(initPayload['live_board']['away_errors']) + \n          dataReader.force_ones(initPayload['live_board']['home_errors'])\n        }\n        \n        if (initPayload['sboard']['hitter'] != undefined && initPayload['sboard']['hitter']['uni'] != undefined) {\n          payload += dataReader.add_tens_zero(initPayload['sboard']['hitter']['uni']);\n        } else {\n          payload += '  ';\n        }\n        \n        payload += ' '; // Error/Hit Flag\n        payload += '     '; // Add 5 blanks for 25-29\n        \n        let last_number = null;\n        initPayload['innings'].forEach(element => {\n          if (parseInt(element['number']) <= 10) {\n            last_number = parseInt(element['number']);\n            payload += dataReader.force_ones(element['away_runs']) + dataReader.force_ones(element['home_runs']);\n          }\n        });\n        if (last_number != null) {\n          while (parseInt(last_number) < 10) {\n            // Fill in the with blanks up to 10\n            last_number += 1;\n            payload += '  ';\n          }\n        }\n  \n        // 50-57 is Guest Name\n        var guest_name = initPayload['live_board']['away_name'].substring(0, 8);\n        guest_name = guest_name.padEnd(8);\n        payload += guest_name;\n  \n        // 58-65 is Home Name\n        var home_name = initPayload['live_board']['home_name'].substring(0, 8);\n        home_name = home_name.padEnd(8);\n        payload += home_name;\n  \n        //66 On First 67 On Second 68 On Thrid\n        if (initPayload['live_board']['on_first'])\n          payload += '1';\n        else \n          payload += ' ';\n        \n        if (initPayload['live_board']['on_second'])\n          payload += '1';\n        else \n          payload += ' ';\n  \n        if (initPayload['live_board']['on_third'])\n          payload += '1';\n        else \n          payload += ' ';\n  \n        //Pitch Speed 69, 70, 71\n        if (initPayload['sboard']['last_velo']) {\n          payload += dataReader.add_hundreds_zero(initPayload['sboard']['last_velo']);\n        } else {\n          payload += 0;\n        }\n  \n        //Pitch Count \n        if (initPayload['sboard']['pitcher'] != undefined && initPayload['sboard']['pitcher']['stats'] != undefined) {\n          payload +=  dataReader.add_hundreds_zero(initPayload['sboard']['pitcher']['stats']['pitches']);\n        } else {\n          payload += '   ';\n        }\n  \n        payload.padEnd(133);\n  \n        dataReader.testClient.init(payload);\n        console.log(\"Result Payload ==== \", payload);\n    })\n  }\n\n  forceStop() {\n    if (this.dataSubscription != null)\n      this.dataSubscription.unsubscribe();\n    this.testClient.destroy();\n  }\n\n  init () {\n    this.prepareData();\n    this.getData('https://pitchaware-web-prod.s3.amazonaws.com/media/livestats/mg005998ce210322b24e6ea7d69a5f00aff14c8bd9_game.json');\n  }\n}\n\n// let dataSubscription = null;\n// const subject = new Subject();\n// const dataSubject = new Subject();\n// // const testClient = new Client(SOCKET_PORT, SOCKET_HOST);\n// const testClient = new Client();\n\n/**\n * \n * Input Values\n * \n *  hash: game data json recognition\n *  bot_code: specific code for the game score board socket\n *  timeout_duration: total time in seconds for this module \n */\n\n\n\n\n\n\n\n\n// testClient = new Client();\n\n"],"file":"reader.js"}